<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <title>Калькулятор лакерства</title>
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="main">
    <h1>
      <a href="/" class="logo-link">
        <svg class="header-logo svg-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
          width="625" height="625" viewBox="0 0 625 625">
          <defs>
            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
              <stop offset="55%" style="stop-color:#22d3ee;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#34d399;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path fill="url(#logoGradient)"
            d="M92.9473 62.3285C101.969 62.1231 109.426 61.9983 118.436 62.3697C120.605 64.3232 125.844 65.4006 128.653 66.7275C140.106 72.1382 150.046 82.8306 153.998 94.9042C186.916 85.3874 217.914 86.2089 250.858 95.586C251.496 88.465 258.213 78.3832 263.646 73.7914C280.896 59.2121 307.447 62.684 321.419 80.1919C329.393 90.1841 333.072 104.089 331.798 116.918C330.377 129.281 326.453 136.988 318.121 145.93C319.001 147.389 319.902 148.698 320.96 150.033C329.049 160.237 337.034 170.537 345.076 180.776L403.063 254.455L468.889 337.713L494.939 370.529C499.171 375.836 503.369 381.994 508.027 386.774L507.97 386.281C507.592 382.801 507.805 377.333 507.836 373.709L507.902 353.906L507.618 259.68C507.544 244.219 507.603 228.687 507.443 213.244C507.418 210.827 507.109 198.818 506.315 197.422C501.946 189.743 494.425 180.843 488.871 173.783L458.173 134.719L425.687 92.9275C422.917 89.3648 413.036 76.249 410.374 73.8343L556.275 73.8416L600.88 73.8396C605.95 73.8424 618.691 73.5436 623.306 74.0982C623.717 79.28 623.098 86.0824 623.076 91.4953L623.064 131.709L623.204 265.155L623.698 405.026L623.722 444.468C623.719 453.912 623.817 463.605 622.765 473.015C622.421 476.085 621.494 479.435 620.842 482.463C612.664 520.416 583.249 551.638 545.101 560.101C542.185 560.748 539.558 562.513 536.524 562.598C533.517 562.727 530.503 562.629 527.498 562.631L510.144 562.701C504.453 562.735 493.434 563.403 488.358 562.684C484.749 557.259 478.375 549.769 474.19 544.566L449.542 513.698L349.314 388.279L322.92 355.539L312.743 342.875C311.03 340.71 308.588 337.825 307.178 335.55C298.857 343.636 290.413 350.85 281.615 358.499C275.396 363.907 265.021 371.406 262.073 379.323C260.482 383.595 260.743 392.412 260.67 397.347L260.044 472.579C246.798 460.113 233.287 447.761 219.968 435.368C210.433 426.496 200.944 417.176 190.907 408.877C188.617 406.984 185.595 404.016 183.323 402.393C186.315 407.227 192.362 414.602 195.955 419.227L215.623 444.637L282.212 527.462C290.957 538.299 302.432 551.611 310.679 562.692C303.287 563.029 295.845 562.748 288.426 562.717L252.917 562.699C239.998 562.697 226.666 562.718 213.733 562.437C211.594 562.39 206.772 560.577 204.028 560.15C151.801 552.01 101.297 528.836 61.5242 493.961C31.0195 467.073 8.65784 431.07 2.23715 390.622C1.61413 386.697 1.32078 379.179 0 375.809L0 338.25C0.932661 336.204 0.932291 333.566 1.17679 331.316C6.67808 280.691 28.1807 232.92 55.2119 190.26C60.0876 182.565 65.6149 175.275 70.4534 167.625C32.372 138.962 42.8581 78.6731 88.4769 64.4334C90.1904 63.8986 91.4912 63.3908 92.9473 62.3285ZM280.012 328.114C266.883 320.219 263.224 325.223 249.579 328.189C235.656 331.216 219.65 330.147 207.349 322.438C203.223 319.914 196.316 315.319 199.801 309.561C202.473 305.333 205.927 307.448 209.63 309.141C214.176 311.219 218.794 313.77 223.988 314.838C234.414 316.981 253.217 316.294 261.424 309.081C265.496 305.501 264.334 295.259 259.453 293.053C253.209 288.356 240.348 285.562 238.634 276.843C237.487 271.01 242.038 267.168 247.455 267.073C249.914 267.03 252.359 266.889 254.898 266.928L278.342 266.752C282.098 266.719 288.375 266.307 291.825 266.952C303.362 269.111 299.702 281.087 293.125 286.777C285.241 293.598 276.784 296.743 277.09 308.367C278.104 310.364 279.406 312.11 281.677 312.878C294.975 317.375 300.496 305.691 303.917 295.09C307.636 283.564 307.063 269.947 300.91 259.242C296.964 252.08 291.85 245.578 286.889 239.108C282.681 233.509 276.604 227.692 274.008 221.133C270.101 211.261 269.115 196.165 274.409 186.533C279.14 177.922 292.555 175.936 299.165 183.761C302.354 187.537 304.621 192.661 307.05 196.965C312.238 207.55 318.496 217.898 323.443 228.56C330.493 243.75 330.283 260.985 326.593 277.013C324.262 287.226 322.066 297.433 319.109 307.479C321.852 302.969 324.983 299.056 327.704 294.633C338.192 277.588 343.326 258.666 338.579 238.755C336.059 228.184 330.598 218.378 326.759 208.275C323.624 200.024 321.385 191.117 318.328 182.806C309.659 159.234 293.45 134.88 271.74 121.627C248.646 107.53 219.297 101.942 192.422 103.276C158.787 105.526 136.14 116.914 113.49 142.212C71.9963 188.359 43.7512 265.818 97.4607 314.567C122.589 337.375 157.983 344.584 191.177 348.213C217.595 351.101 255.536 352.778 276.619 332.325C277.725 331.253 279.005 329.382 280.012 328.114Z" />
          <path fill="url(#logoGradient)"
            d="M193.151 175.912C213.137 175.524 226.388 193.838 224.852 212.602C223.422 230.061 203.071 248.193 194.81 263.331C191.789 268.867 188.15 275.932 183.433 279.915C178.083 284.431 171.257 284.744 164.595 284.014C149.57 281.572 132.848 267.674 131.831 251.41C130.566 231.173 149.069 210.002 161.24 195.087C169.173 185.366 180.219 176.682 193.151 175.912Z" />
        </svg>
      </a>
      Калькулятор лакерства
    </h1>
    <div class="luck-scale">
      <div class="luck-item luck-item-special" title="За отмеченные звездочкой можно получить роль в Discord'е">
        <span class="luck-range">0–15:</span>
        <span class="luck-desc">опоссум ★</span>
      </div>
      <div class="luck-item luck-item-special" title="За отмеченные звездочкой можно получить роль в Discord'е">
        <span class="luck-range">15–30:</span>
        <span class="luck-desc">антисвин ★</span>
      </div>
      <div class="luck-item">
        <span class="luck-range">30–40:</span>
        <span class="luck-desc">почти нормис</span>
      </div>
      <div class="luck-item">
        <span class="luck-range">40–55:</span>
        <span class="luck-desc">нормис</span>
      </div>
      <div class="luck-item">
        <span class="luck-range">55–60:</span>
        <span class="luck-desc">почти свинка, скоро повезет</span>
      </div>
      <div class="luck-item">
        <span class="luck-range">60–70:</span>
        <span class="luck-desc">свинья</span>
      </div>
      <div class="luck-item">
        <span class="luck-range">70–80:</span>
        <span class="luck-desc">боров</span>
      </div>
      <div class="luck-item luck-item-special" title="За отмеченные звездочкой можно получить роль в Discord'е">
        <span class="luck-range">80–90:</span>
        <span class="luck-desc">свинотавр ★</span>
      </div>
      <div class="luck-item luck-item-special" title="За отмеченные звездочкой можно получить роль в Discord'е">
        <span class="luck-range">90–100:</span>
        <span class="luck-desc">свинозавр ★</span>
      </div>
    </div>
  </div>
  <div class="container-wrapper">
    <div class="container">
      <h2>Genshin / HSR / ZZZ</h2>
      <fieldset>
        <legend><strong>Персонажный баннер</strong></legend>
        <label for="charPulls">Всего круток</label>
        <input type="number" id="charPulls" min="1" step="1" placeholder="Пример: 4207" />

        <label for="charWinrate">Винрейт 50/50 (%)</label>
        <input type="number" id="charWinrate" min="0" max="100" step="0.01" placeholder="Пример: 45.24" />

        <label for="charAvg">Средняя лега</label>
        <input type="number" id="charAvg" min="1" step="0.01" placeholder="Пример: 64.26" />
      </fieldset>

      <fieldset style="margin-top:20px;">
        <legend><strong>Оружейный баннер</strong></legend>
        <label for="weapPulls">Всего круток</label>
        <input type="number" id="weapPulls" min="1" step="1" placeholder="Пример: 1769" />

        <label for="weapWinrate">Винрейт 75/25 (%)</label>
        <input type="number" id="weapWinrate" min="0" max="100" step="0.01" placeholder="Пример: 59.26" />

        <label for="weapAvg">Средняя лега</label>
        <input type="number" id="weapAvg" min="1" step="0.01" placeholder="Пример: 46.5" />
      </fieldset>

      <div style="display:flex; justify-content: space-between;">
        <button id="calculate">Рассчитать</button>
        <button id="reset">Сбросить</button>
      </div>

      <div class="result" id="result" style="margin-top:15px; font-weight:bold;"></div>
    </div>
    <div class="container">
      <h2><small>WW</small></h2>
      <fieldset>
        <legend><strong>Персонажный баннер</strong></legend>
        <label for="charPullsWW">Всего круток</label>
        <input type="number" id="charPullsWW" min="1" step="1" placeholder="Пример: 1004" />

        <label for="charWinrateWW">Винрейт 50/50 (%)</label>
        <input type="number" id="charWinrateWW" min="0" max="100" step="0.01" placeholder="Пример: 47.62" />

        <label for="charAvgWW">Средняя лега</label>
        <input type="number" id="charAvgWW" min="1" step="0.01" placeholder="Пример: 60" />
      </fieldset>

      <fieldset style="margin-top:20px;">
        <legend><strong>Оружейный баннер</strong></legend>
        <label for="weapPullsWW">Всего круток</label>
        <input type="number" id="weapPullsWW" min="1" step="1" placeholder="Пример: 568" />

        <label for="weapAvgWW">Средняя лега</label>
        <input type="number" id="weapAvgWW" min="1" step="0.01" placeholder="Пример: 62.89" />
      </fieldset>

      <div style="display:flex; justify-content: space-between;">
        <button id="calculateWW">Рассчитать</button>
        <button id="resetWW">Сбросить</button>
      </div>

      <div class="result" id="result-ww" style="margin-top:15px; font-weight:bold;"></div>
    </div>
  </div>

  <!-- Tilt эффект для карточек -->
  <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.VanillaTilt) {
        VanillaTilt.init(document.querySelectorAll('.container'), {
          max: 8,
          speed: 600,
          glare: true,
          'max-glare': 0.15,
          scale: 1.01
        });
      }
    });
  </script>

  <script>

    const clamp = (x, min, max) => Math.min(Math.max(x, min), max);

    /**
     * Расчет удачи для Genshin/HSR/ZZZ
     * @param {number} WR - Винрейт игрока
     * @param {number} AvgL - Средняя лега игрока
     * @param {number} N - Количество круток
     * @param {number} WR_avg - Эталонный винрейт
     * @param {number} AvgL_avg - Эталонная средняя лега
     * @param {number} N0 - Минимальное количество круток для достоверности
     */
    function calcLuck(WR, AvgL, N, WR_avg, AvgL_avg, N0) {
      // Коэффициент достоверности (от 0 до 1)
      const confidence = Math.min(1, Math.sqrt(N / N0));

      // Фактор винрейта: больше винрейт = больше удачи
      const wrFactor = (WR - WR_avg) / WR_avg;

      // Фактор средней леги: меньше средняя = больше удачи
      const avgFactor = (AvgL_avg - AvgL) / AvgL_avg;

      // Комбинируем факторы с весами: винрейт 0.6, средняя лега 0.8
      const luckRaw = (wrFactor * 6.1 + avgFactor * 0.9) * confidence;

      // Масштабируем к шкале 0-100 с центром в 50
      const luck = 50 + luckRaw * 50;

      return clamp(luck, 0, 100);
    }

    /**
     * Расчет общей удачи для Genshin/HSR/ZZZ
     */
    function totalLuck(dataChar, dataWeap) {
      const Lc = calcLuck(dataChar.WR, dataChar.AvgL, dataChar.N, 50, 75, 10000);
      const Lw = calcLuck(dataWeap.WR, dataWeap.AvgL, dataWeap.N, 75, 65, 4000);

      // Взвешенное среднее по количеству круток
      const total = (Lc * dataChar.N + Lw * dataWeap.N) / (dataChar.N + dataWeap.N);
      return clamp(total, 0, 100);
    }

    /**
     * Расчет удачи для WW
     * @param {number} AvgL - Средняя лега игрока
     * @param {number} N - Количество круток
     * @param {number} AvgL_avg - Эталонная средняя лега
     * @param {number} N0 - Минимальное количество круток для достоверности
     * @param {number|null} WR - Винрейт (для персонажного баннера)
     * @param {number|null} WR_avg - Эталонный винрейт
     */
    function calcLuckWW(AvgL, N, AvgL_avg, N0, WR = null, WR_avg = null) {
      // Коэффициент достоверности
      const confidence = Math.min(1, Math.sqrt(N / N0));

      // Фактор средней леги
      const avgFactor = (AvgL_avg - AvgL) / AvgL_avg;

      let luckRaw = avgFactor * 0.7; // Вес средней леги 0.7

      // Если есть винрейт (персонажный баннер)
      if (WR !== null && WR_avg !== null) {
        const wrFactor = (WR - WR_avg) / WR_avg;
        luckRaw = avgFactor * 5.0 + wrFactor * 0.9; // Винрейт 0.5, средняя 0.7
      }

      // Применяем коэффициент достоверности и масштабируем
      luckRaw *= confidence;
      const luck = 50 + luckRaw * 50;

      return clamp(luck, 0, 100);
    }

    /**
     * Расчет общей удачи для WW
     */
    function totalLuckWW(dataChar, dataWeap) {
      // Персонажный баннер: эталон 65 круток, винрейт 50%, N0 = 10000
      const Lc = calcLuckWW(dataChar.AvgL, dataChar.N, 65, 1200, dataChar.WR, 50);

      // Оружейный баннер: эталон 65 круток, без винрейта, N0 = 2000
      const Lw = calcLuckWW(dataWeap.AvgL, dataWeap.N, 65, 1200);

      // Взвешенное среднее
      const total = (Lc * dataChar.N + Lw * dataWeap.N) / (dataChar.N + dataWeap.N);
      return clamp(total, 0, 100);
    }

    // Обработчики событий для Genshin/HSR/ZZZ
    document.getElementById('calculate').addEventListener('click', () => {
      const pullsChar = parseFloat(document.getElementById('charPulls').value);
      const winrateChar = parseFloat(document.getElementById('charWinrate').value);
      const avgChar = parseFloat(document.getElementById('charAvg').value);

      const pullsWeap = parseFloat(document.getElementById('weapPulls').value);
      const winrateWeap = parseFloat(document.getElementById('weapWinrate').value);
      const avgWeap = parseFloat(document.getElementById('weapAvg').value);

      if (!pullsChar || isNaN(winrateChar) || !avgChar || !pullsWeap || isNaN(winrateWeap) || !avgWeap) {
        document.getElementById('result').textContent = 'Пожалуйста, заполните все поля корректно.';
        return;
      }

      const dataChar = { N: pullsChar, AvgL: avgChar, WR: winrateChar };
      const dataWeap = { N: pullsWeap, AvgL: avgWeap, WR: winrateWeap };
      const score = totalLuck(dataChar, dataWeap);
      document.getElementById('result').textContent = `${graduateScore(score)}: ${score.toFixed(1)}/100`;
    });

    document.getElementById('reset').addEventListener('click', () => {
      ['charPulls', 'charWinrate', 'charAvg', 'weapPulls', 'weapWinrate', 'weapAvg'].forEach(id => {
        document.getElementById(id).value = '';
      });
      document.getElementById('result').textContent = '';
    });

    // Обработчики событий для WW
    document.getElementById('calculateWW').addEventListener('click', () => {
      const pullsChar = parseFloat(document.getElementById('charPullsWW').value);
      const winrateChar = parseFloat(document.getElementById('charWinrateWW').value);
      const avgChar = parseFloat(document.getElementById('charAvgWW').value);
      const pullsWeap = parseFloat(document.getElementById('weapPullsWW').value);
      const avgWeap = parseFloat(document.getElementById('weapAvgWW').value);

      if (!pullsChar || isNaN(winrateChar) || !avgChar || !pullsWeap || !avgWeap) {
        document.getElementById('result-ww').textContent = 'Пожалуйста, заполните все поля корректно.';
        return;
      }

      const dataChar = { N: pullsChar, AvgL: avgChar, WR: winrateChar };
      const dataWeap = { N: pullsWeap, AvgL: avgWeap };
      const score = totalLuckWW(dataChar, dataWeap);
      document.getElementById('result-ww').textContent = `${graduateScore(score)}: ${score.toFixed(1)}/100`;
    });

    document.getElementById('resetWW').addEventListener('click', () => {
      ['charPullsWW', 'charWinrateWW', 'charAvgWW', 'weapPullsWW', 'weapAvgWW'].forEach(id => {
        document.getElementById(id).value = '';
      });
      document.getElementById('result-ww').textContent = '';
    });

    function graduateScore(score) {
      if (score < 0 || score > 100 || isNaN(score)) {
        return "Некорректный счет 😕";
      }
      if (score <= 15) {
        return "Человек с проклятием 😣";
      } else if (score <= 30) {
        return "Сильный анлакер 😞";
      } else if (score <= 60) {
        return "Обычный игрок 😐";
      } else if (score <= 90) {
        return "Свинья 🐷";
      } else {
        return "Проклятое свинство 😈";
      }
    }

  </script>
</body>

</html>